language: java

services:
  - docker

env:
  global:
    - secure: "R1cFki+8j1O5rktZy5wQlggT795C6hfnQI3l8gEvVZbfgp7oj9mABENq2hPDRo4PHFcH+AU3ZHwU85ESmuwnAjYFkBv00eS3iC/wtXN9pVhyXZK1bTCE+9fiMTZMcAx8N7YgDu6j2qHZIofv3ARU/tdBZenugwhxgzHxWevN8gHHapjszjmFS1gm7jMNOHy/K2SreVDjxKZ9FZq16RtsXz89nIyH4H0OMC/laY25IXovP0qc+JMN0gkdEgRpWyP75cKMq2Fk/9opw5P3LRU0CB9lXgqd77BEJMkbYWFo2MOXRxiI6QXidRFAOKlvGTDHVXatmQ0/b1VvCYGuIx2AfARJ8tAyMS/bzfqPwfy9ISZzRy1C8S4xbZA9PjMcuCjazzJbZHOA0DYcIErIhEbEwY0xnEPQ5uP1+vvum9ookbEDzZ7QN6wXMsm701FwRVzJv2z9YxJalFBwoC18DUjIMkCVZ5MkDl/FExRfLzbPEYwtPBQr6lVB7QSvajun+gTbQCeiI/bROFft9GPOdG/9GjaI5I0/ylgVA4Cp4+i1LHRh6ZByS1AMiAAjlZ7zunmXsLNaKAJr78u+3kGHN+hi/fSorc8lMs2XZTdtycpqiUqnSMjyMJpFnLOKiR8kpRa9vy/ntIbVv4qCG5/YanhCUci2wpLBcNDuHFBerU66wFo="
    - secure: "AikpDrWw7XxLmYFz7gvFrinS+mr3LMWuPc5kMp8RKhdEq/yMGD+UQ5mlQPl7fmRIQdTkAB2RlyYWFrTAirHp66ByhYqO/vcJb4AiQJ5T7Kot1L8pyI9DRGbkYZaM+b168effpju3mxRPG2C/e8RCjyBjLaQbSigj10HADOgKBzWKl55e6o2gnAgLHiDXZg02n2q83t5VEndbKqsvWq/1Hnmv1JjlsjfcXL/kfsNf0DQ/fqY6Z+EXAwevseVOzidGdZ7aPPPH43R41CGKkOn/VGa30nw8whe9sVGlCSJeDpdJ5c4pKqvVt6wbwnNKT+efncpJThUgQ5eJEvWKke4QVtbI79SPmo3hpE+HRHvO6A+D08ewtrSKN4xFlxVMWurj75zuy35d3DvFjGi01JWTkd9WQ3pPmTYzSXmWia2M5OK648lxJYE4o2qLqVH+Oru67YFiigvA5KdC7SWfUYf/yLLZ/ZzHDuq70jlO1bFZYgGgfOO30OS1KFYp6MNA3m7WxGvIkQ2WLizLvj7exGSo2fKBEC4H2SP989HpFVGvnIwK6m0CtLKiofkRQNPXQ6ndBpVGG8PBwHNDnqMvWEnJEDWwKp9OCHpNoxsFaTIJlIg6CbeTRHz/fAWnup7Zb7vJR/cMsO0lqa+ypdPYWWFwFDswElTQE476Q0NnYi6MNNE="
    - secure: "ObzW1UHSjNrNjYjJU8Qwdefu0YfXesKGNOgefE7KbsaRN9OcsPpwaRd2AJVhTW8nJ7rLazGeeVuG1cdMnh5h5MkWz/rLOIjS0PR4gTpNiUlIJvuKJ8/vG3CZGnYpHrYkq+hWqvKIGY73TNMO5mZgRKn6EyIor21/NOM/jCPzGgWUg2GtJb3TGdD4uFu+dXX0HWLsEocYkLnRgQ8mfqxjKaKiisEV1JAAHBnm+60AWBux4wUZpw39kyIA7JfoxubDABv9onHk7Om9zcTa9N2xpKnEvKs1fFIF6VniRYFd6bgwE+ILqqiNnidhjPLvnkF28HVUSv7vhRDDT2O8qM2cpKkFSMmBnVRHX7zGPEhgBC8jYnSRXJ/zJsffb4WPVfV+INDTFtPNNgSQp6lJEwQShNqpzrFidrnqJb8r2iubihYMntfr2XCpDwlIdG0VsnvwplsRRo96yFdzxf3jj/UF5TottVrppTlCyB9ESGAGztAICMOTkIEt2iYCjQQ/1Yvqx6kMJ/SlVvHlj+wunYUxi3uwFJss8zOMSzU/VSZAS5v2Fm5fnxntFGDG4W5cA0QxIFn33LQsMW4BiQE5OSJwl+uNsEHpLlicKs0d8L2Lbesu+ct1mrjT9mJBHUa+yqe83IG2ovaKjdUHQMJFYOOYUKXX7dKE0BtxqqpLE0G2KQA="
    - secure: "jfKfBTXSFTZ8QQBtDVXfAy1X5cm3E2qMq1cWbhR0MDRI/v+441AtAOeJiN+aHhGXcm141QNiq+uhlgpU4K5nlRx+pVOfrIpqaBxDoGcRzvChF10QrvQ5oE2ViAr3Yp1L/koiOQIOqtAlN3O98ldmrNGWEOmtlOJeq49YtP6HR7VU7N+q1T34YeCxGNK8mRA/b6GKdcobf/RqrBgAZ2otwogcP6iJIzbgBl5id9OBa0wxanOVNfbLCkign0ZwQGjWDEKItmGv7b9+oN0aGg3MMHdZ4g2wyv925+v/zbWeYoSKT5PqmYPHa/7OgdPt8Eikp74D0vDnFVSWM5L8rpkLR2JxvfSbd3CCYRe7LMzC0Q812HavlRQH8cLcyT/OAJBKAKYjk7ykbj0nroyn1wi2GzUHxgiihTWXkPqoASscUhrau2uWvih1OLuw3p7+HJO9F4bn/Uw/vTe40Xvv0YQO+5V9TTDfegqzc3d4cvJTxgJ3qSkDxEU1x8Okq3R7pgLV+n84e0FNucDz7Tg37Dzm1a26p+5SppwaGTgvvBD6Fm5vAH2yUs0TKSOcdHxgzzXTajh2CNGZqgnI7KW/F+p7P5zDatgkOWw0DWl9tZ4p9jLCYHiPaiyDXswQRDiE6K1tk8RPB8niq+OJN130oXE4lfa9gr59+WDTpytfJ7aMc9I="
    - secure: "iHwZ7wRRvKmYZNX5XI+hS9ypPzLzWmjnT37D/hhg9tHl8t221dbb6xISwnpgyHbPDCo3YY3lZk2SJ45v/dBV5msoPOCr4rpyzd0pMHfnXIT1U9t0RAKbVIC3WC/L0oVPfIXaTi4WAJE5QBTBEHPhhcxnGVEXwDVboRQPsiyhXpJkGx/iHMt+lanD8WmFlC97NiCK2OpUxfeq+qRwM895grPk7qtRCo1Hl/dxRLVd56LplcPo+iyc8extsGKhkgjvJwmc/p0n+hHq6AE0UvIZnz3uAU8s7190POoCGzHVLCqLGwdIhd0jIwIY/fcLtqgfKzCvwS8CeV4OiaPkDM+eYy64noXpqU+NCP4k8eLIIYoCZpwaHQMR97KV4jQhhcLdYqfnbxBIERLuPa174nL8T7JfO2ZUPNAiO+hEngcuwVkKsfSGcaPzfyDskgRyF4u5Z+do9M43b8lBFmONsnDJX4dVbpo8UTMm1uVqbjU2wqhhy8bocH6wEqy8F1VIVdREt9mfyifYR2vLBzV6f3Qkt1diaOLDGsqX8OZ9EwIWunP/hpsMZx1sT6VoY/5UBO3hxOh7HuA02+MEAM6OzG6LpShb3L5DWKP96LOYk7JlYX/JfHK5VaIPPUdmpJP7UA1LKc1JyI3iWXlAhuT6lvgtLvMEpAGqy4cK7wX6MT34wpE="

before_install:
  - mkdir /home/travis/data
  - mkdir /home/travis/gedbrowser
  - cp $(find . -name 'gl120368.ged' | head -n 1) /home/travis/gedbrowser
  - cp $(find . -name 'testUserFile.csv' | head -n 1) /home/travis/gedbrowser
  - docker run -v /home/travis/data:/data/db --name mongo -p 28001:27017 -d mongo

install: mvn install -DskipTests=true -Dmaven.javadoc.skip=true -DskipDocker -Dfindbugs.skip=true -Dcpd.skip=true -Dpmd.skip=true -Dcheckstyle.skip=true -Djacoco.skip=true -B -V > /dev/null 2>&1

jdk:
  - oraclejdk8

script:
  - docker ps --all
  - mvn --batch-mode install jacoco:report coveralls:report -Dspring.data.mongodb.port=28001 -Dgeoservice.keyfile=stub -Dgeoservice.backupfile=/home/travis/gedbrowser/geoservice-test-backup.json -Dgedbrowser.home=/home/travis/gedbrowser -DrepoToken=${REPOTOKEN}

after_success:
  - docker run --link mongo:mongo -v /home/travis/gedbrowser:/var/lib/gedbrowser -p 8086:8080 -p 8087:8080 --name geoservice -d dickschoeller/geoservice:snapshot
  - docker run --link mongo:mongo -v /home/travis/gedbrowser:/var/lib/gedbrowser -p 8080:8080 -p 8081:8081 --name gedbrowser -d dickschoeller/gedbrowser:snapshot
  - sleep 1m
  - docker images
  - docker ps --all
  - mvn --batch-mode --settings=settings.xml -DskipTests=true -Dmaven.javadoc.skip=true -Dfindbugs.skip=true -Dcpd.skip=true -Dpmd.skip=true -Dcheckstyle.skip=true -Djacoco.skip=true -DpushImage deploy
