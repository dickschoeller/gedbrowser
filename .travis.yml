language: java

services:
  - docker

env:
  global:
    # REPOTOKEN
    - secure: "nqpQ1c4b74dd15/eSZBb02QE3HS4Hq/3cPdzUAtKNWErHALkWjRXa6VvrjO9F30G+2TGm/cdK6tX2lp1PPYeUnR8eEwxbTSw1czw/Dzc/RvggbIek/fTn3O6ihUXESY+rbRhRMyGlQ7vPmQKo0f0dMjv33SsKfHxL3jtlbFUnJSFFxhGgDCe54akTMZyCGBiYYnQZKOWWhKAFTS1kT8Um+/l2fZo1LTmLSfr8aJF1irDLfvAbtV3DKsJwgnt7um/PqYOBXK+6XaZ7P6Zo7nd5qS+ZNm2WzgTnHETNSvDRAzAyUydJHorf52MsmNiLSb3qQdWluk+9vewWVs61qPMH9pZPTlS8wgCcyJ3jceTlG9HM1dREALhXXHFoCmKUX9DgWHxREuSy/88gTVKg5qiRTVo/UXE5BrsXb08AawXi8IM4yuQHJxfTcuIv05+CsbzHqyysUQkwSVXA7wYjEMJ3WhY2p0ss0Oxohu5JHQZ1YYByO0xg4Hrm0eTLWsnq9ZTnfoT4MpATX8h73grSWe4mSmIVmqcs2egEwLolmTBD5lFRaQum7N3+SZ66dVwT1H3fgqhne1wuMPWwAWVVdZY3l0fxZoR7qD6WbO7BUwo0F4fSIo9RFgcQUKtx+jWJ9Bgql5th9prc3wuJuSdUHOe6hmcDyfsSi8BMoB2jZP4Hcs="
    # GPG_PASSSPHRASE
    - secure: "C9rq6YfXUZsrfSOosvHhz6XalhgAa5DYa7zXKiSLioRUi9j8Gy/oY6cei905r3c+442w0I8rUmHSE8Zw9j4XeLBp9drijvOkAgr0gTzq8EtxNgYNQkpXPTF/1ehk6CmrXe/S6hLlYZ5iO/XMd+zu0COnUvktfbd/3lwC/5C/RhrpXa5AMzkQ/Ejqr6EvcWyhOgQEyh5U7uEjzTxn62Og69wYCf73jmfctEzYlgAagPt3hiDi7dHJ91S9fTywRzcn9OUGzsUAKgqh6ga5mbRbZPumpqNG/eDAvTUlhIGVCPEBOrVL2ot/tx+ah5EupM2ITjy0D3qe72YP0v3q40PVedljaTM170B+KTddGO1z2GFD+VLrkerhOn6YaoNbgo9s54XdlyAJWk8W3+dgBwm9/jEqiNWWNGi8eQvmG5cA8F70BCHQ4zfU0SH1/9AjGTRoKOeNTY1VS8HURh4Tnvlm01W9Km+9r+3qJFQbqQACJRxZ57KwEWLGNEK2FNbUSB+vh8/pjp1SaBUu5hx2nwFH5wWXyV5iMO9qjBaduxux44/YapVtXRet+V7MmGAIF6tSSvaQ2mkwQ2NMvuTjPsFaJ6zv7VYWW+/4pXT6tj9tTHgtfkopY34I8czqFd+h6F75OlkQhir/cQjol1lf2gv5J8egnBst8NpRLGsrapgSUf8="
    # GPG_KEY_NAME
    - secure: "KVpOHU7Oy44evUDdcWwWvNWWf2EvWQBeC5xcEiObCPz09U8tKRz8pX8bqwM1B8kFrXBNfrALFVkpgkqbb0pVuWbrKjqXKby+r05JR2pe0wPp/228nrNaRyD2OoruvF1+AJyWquS2CiDt68MkfNF6eJNcptYDMZnv8Nr2vb+hZkUn10Fqek9NvWnAsWTjPANZdpQjPrHHScRvLVadkCMubYr6WA+CSptBwYw+Tc9/Qgm0FZPsnDH82zD79JIKRQlorTedwZ1HxRwKFuwL1R1FgQXGIEFXgkT9N4E+93pF6QoeKacRrJWEt8Pq52dWpBqvT/mECkSPQ4swtVpoFU2NboBrtDcTyndH9yDfk0Xl6ASBSuV1KLUF4fF2My4Pv+HhB4j9TayrHkOkxSVdBJFNuo/UTProj4RxfGd4Zjca1ia9rHTYViAfX6syM2yrG0/Sx1tdHoDaZtmm54eJBxYqmCZnzw2ve69heIgdgBuy5U5qJPeJw+KMZx57yPEUpz1tgOk8KufAFB1k3S/AkBrnBPEhxY5+ls0GR2hVZwNwUi5CHcfKv5VkMQs2yyYmqM/rDu7ls0FmeOkFVOFnojM2dEyvOnegMkpJRlEAhIjRg7GtiTRQSZArohxFqWGxJUS6JscxaUlP6VklHcI5IwlFCI47G2ZsvUHxpj40J+0taGA="
    # DOCKERUSER
    - secure: "oWjizEIkmJeJl2JSe7KcbB4+Fhz5UPs7agqOuh2nU+3RE60YE7HkCGKhmWYfz4jhl2bvC1KKeK1YfhZCeHtU5dBhYtipQRmrfc46vuqSR0DjTR6TuE4YhhHGjBrlkdSX/wx9zjidp51ZIC/p0ne3YL0Ehgo6Mm4WRzkrz69Ka8vg1G44gf5Tkw9ZDvYrLt7tDSxOWRzXc6sOnf5JxH+2VBPrYF544DVXdylHMewVDGvOXAb+8Xvmb6JHqkjinTtJK7bzV9gMau/SRPea03ticy6rksh4aC9LTU2GsRkAbVd6xtD135kbaMexj4Z66RaxMvZy4rP9EpgRbfSD9Rc/gO2N2JBxFK2q2aZNxQOOx4fUM4RMm1YSpovL7ENuYRzVmaBZxMF6BOxIzZFmUo8pv6IJkO9NpV6PczbVwl8WX7TcK87l4g0NbbzV0mM95LS4rYF8Xii4MN2EVFaURzjae8vE+IknWyaeK+P+V+0iC0PcNN4+jPffN8UC1oQ4zu8KGN5oZAQtuCtmRFiXaIEvHrfxXXc5COc6yBNCtBPZP/LsXBcbdX172bu0jpSAcPOfCiKJ/CT7+1KtVE0EKnuMpDYegPOSAAIRROd9Brn7bKWhsFDtftr8hNY7nVEBDKiIPZxbCEzXgLRzv0x9UymqVXYPBBHHTVaSrzcDk5TQ00A="
    # DOCKERPASS
    - secure: "C0bDP7SoCRKAg45ZdUQOJjGshwsZZVHOgCO/IH/6lkGbFfIVeUPhaaEivyMvzB58lwNzvyYVu7db/FblddNj1PDETq/XIhK3N+8k5egSsBeL1WTrxDVJQTucVMBEsudz9+QYu6Ieelowyxma5aN9m1dKMwzv0IiGDw6TZgnZA0wOALk+UQeXBgCATaDkEm2uPzaKnG/g2V6tqSghB1SbrvmvFOn5xEqyvxHZxJ5cdpnto2QiIfhFH4vBscQwUAltTupi1A+pTQF2IrKEVL5YGXB6E0IexOWzpuhk7pN2SbkepM0ZPzaKIDGplkt3eoj7GafHWgbOgSJeBr7SD2JKkSW8UgM3Afd7hilF+qdvbC8btMIhS2E7tiuHL1vQg0BZbwYkjWtet/y5hU3asFId5aluZXToCLBKm8WO8BZcAeVq+OwgXsLzFbldVQdhWTNiOOiWsqKLmqfdF680Ma0eU3bY5YXLhK7+pv2gZH54FwnrV5k8TN/qDK81qz/k8sJj0fXMxgPLMa0i9f3QL9WuWBBE30il5XMwugE7CZH8w+p6wOiEtqSX6B6+uSvZw+LMMnMfC9Bqwwsvg3oW6dug0Vd1AuKbY7VQOf1idDJ/xsjvCcjr4Hv5wBQYDGbEmqhMgUKFaqYCxvUlMzabEh0srxXw2DeY5OLznADhqbEeEe8="
    # OSSRH_USER
    - secure: "I7kpYvDzSW8c/aitLg+xrTSTihCEmravYKiBHQd5uEfLUq4iF59jAntYyQZWiO2Hr4GjeVekq6XpMBloddcyfg9RIXWh36BZ6v+1HOTNaA1GqjDLFjGdNBX8zgp1M0tCKor3xM00rMn9XvUcJIYRX3DkPLCefzsoBum4XZEhcVWxppClz1fHgJ/m4Wuc9IX47XWjXOiWha5ACM0osTXgNGEcDDtXDxZV3L+WPeNurATURiKXaCSlYOVIvpVHYAMLga4IT65ia3croRA37+EksRunt5rlhm5F0q9h/GtgCDdUVCl6sRFlq2xjzq5Ff3EpE+p0NWOH/vcvxc6Nre/+qDtoqHbw2Vc9lmnGYw+LUuboGY3hnmbDsqpi1C3aklNPlLgjldQKQ75bi6iWwyFcQ1Gp0+WoQ84qH1xV+HtEcPi8W5HBnD+vyi3RveL44FJ9ttXFwzymmWbgGGNaTwePl+hhwcXp3jYpnAfvlp9pgsKmMnw12g+8WBd5c3NbKCX85NFbKpa3aTp5x5RbfYsmar+qqf1FreiXM0B5noksca1FG0iQCRlTQIwLcQRjQc9AX4MkSPCvu9rrP9vToIBFITjgIaVjZEknf3eNkNjGD96fS1im+56+So5wJmpASPJnVbIJM6Fui+VMZAF4jhUgOi7In7zwDgALKr0oFSbxs44="
    # OSSRH_PASS
    - secure: "QcYMf74iQ//5ahvbXcWqvj0pHz4RtvH/gZWV+uBuhDsuxGDjC6I0jN0X2ew35c2KR1gQJz1jXwxkveU1PH3NNgeq0dOOI7teMDkuULrVaptMzzjU6puJPreq3GCRVE6LSWeSObBfpSfAbGfzoeagXOuUR8wmgh73nKr0vyVPM6QdDewmbdMiSfIYRYRWw+bmMENqn9roehYEHX90L8ac1JSiMaxKkDdL1WFaL3o/9IwrTN9vIXYbklRny8s1Qa81cYHWEO/3jaDEuniDcZ9tw6hH2J0POjewh1cEZwmYbc2H4IGkqLCays7zqqjP7YT9W6JKY2cWLtdTD35Lgr4nOZ8Ned8gzoX2PjuZDi60wv0pddpstic6T8XK/YDd7tnJD0lzSFhOu8auaXpn93UZiroamN1ajW5SHfnmEXt6Dg8coF1/JmXEZfbPaU68LDdcnN8vep5m7mNaS83DlhIyircH95+iPWXyOe+FAW9sOXurc2NnJF4DgMHvcmHosWQtGIuItpnsIyXyfb/ZzKullJ9jLeF+MesCCLy8IFzCBYWf2BKMiNC76OOeE8QLtXi8rFPlQzy1545cvTIPC5nz/pWRwyZ2Vh/cFQILiu/Px0wj1B73TSsH+Neqoyuf9AqeV6ysjYylPys9TcBbmGwz8Yrg4jHFeeFFfkTB+xQRW3k="

before_install:
  - mkdir /home/travis/data
  - mkdir /home/travis/gedbrowser
  - cp $(find . -name 'gl120368.ged' | head -n 1) /home/travis/gedbrowser
  - cp $(find . -name 'testUserFile.csv' | head -n 1) /home/travis/gedbrowser
  - docker run -v /home/travis/data:/data/db --name mongo -p 28001:27017 -d mongo

install: mvn install --settings=config/settings.xml -Pinstall -B -V > /dev/null 2>&1

jdk:
  - oraclejdk8

script:
  - docker ps --all
  - mvn --batch-mode install jacoco:report coveralls:report -Dspring.data.mongodb.port=28001 -Dgeoservice.keyfile=stub -Dgeoservice.backupfile=/home/travis/gedbrowser/geoservice-test-backup.json -Dgedbrowser.home=/home/travis/gedbrowser -DrepoToken=${REPOTOKEN} --settings=config/settings.xml

after_success:
  - ./config/docker-shakedown.sh
  - ./config/before-deploy.sh
  - ./config/deploy.sh
