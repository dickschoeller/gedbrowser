language: java

services:
  - docker

secure:
  - "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"

before_install:
  - mkdir /home/travis/data
  - mkdir /home/travis/gedbrowser
  - cp $(find . -name 'gl120368.ged' | head -n 1) /home/travis/gedbrowser
  - cp $(find . -name 'testUserFile.csv' | head -n 1) /home/travis/gedbrowser
  - docker run -v /home/travis/data:/data/db --name mongo -p 28001:27017 -d mongo

install: mvn install -DskipTests=true -Dmaven.javadoc.skip=true -DskipDocker -Dfindbugs.skip=true -Dcpd.skip=true -Dpmd.skip=true -Dcheckstyle.skip=true -Djacoco.skip=true -B -V > /dev/null 2>&1

jdk:
  - oraclejdk8

#script: mvn install jacoco:report coveralls:report
script:
  - docker ps --all
  - mvn --batch-mode install jacoco:report coveralls:report -Dspring.data.mongodb.port=28001 -Dgeoservice.keyfile=stub -Dgeoservice.backupfile=/home/travis/gedbrowser/geoservice-test-backup.json -Dgedbrowser.home=/home/travis/gedbrowser -DrepoToken=${REPOTOKEN}
  - docker run --link mongo:mongo -v /home/travis/gedbrowser:/var/lib/gedbrowser -p 8086:8080 -p 8087:8080 --name geoservice -d dickschoeller/geoservice:snapshot
  - docker run --link mongo:mongo -v /home/travis/gedbrowser:/var/lib/gedbrowser -p 8080:8080 -p 8081:8081 --name gedbrowser -d dickschoeller/gedbrowser:snapshot
  - sleep 1m
  - docker images
  - docker ps --all
